<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devices - SolarAI Monitoring</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="dashboard-layout">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-logo">
                <svg width="40" height="40" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="40" cy="40" r="35" stroke="url(#gradient1)" stroke-width="3"/>
                    <circle cx="40" cy="40" r="20" fill="url(#gradient2)"/>
                    <defs>
                        <linearGradient id="gradient1" x1="0" y1="0" x2="80" y2="80">
                            <stop offset="0%" stop-color="#22d3ee"/>
                            <stop offset="100%" stop-color="#facc15"/>
                        </linearGradient>
                        <radialGradient id="gradient2" cx="50%" cy="50%" r="50%">
                            <stop offset="0%" stop-color="#facc15"/>
                            <stop offset="100%" stop-color="#f97316"/>
                        </radialGradient>
                    </defs>
                </svg>
                <h2>SolarAI</h2>
            </div>
            
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="dashboard.html" class="nav-link">
                            <span class="nav-icon">üìä</span>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="devices.html" class="nav-link active">
                            <span class="nav-icon">üîå</span>
                            <span>Devices</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#analytics" class="nav-link">
                            <span class="nav-icon">üìà</span>
                            <span>Analytics</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#alerts" class="nav-link">
                            <span class="nav-icon">üîî</span>
                            <span>Alerts</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#settings" class="nav-link">
                            <span class="nav-icon">‚öôÔ∏è</span>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <h1 class="page-title">Connected Devices</h1>
                <div class="top-bar-actions">
                    <button class="theme-toggle" id="themeToggle" title="Toggle Theme">
                        <span id="themeIcon">üåô</span>
                    </button>
                    <button class="add-device-btn" style="padding: 0.7rem 1.5rem; background: linear-gradient(135deg, var(--cyan-glow), var(--solar-yellow)); border: none; border-radius: 8px; color: var(--bg-primary); font-weight: 600; cursor: pointer;">
                        + Add Device
                    </button>
                </div>
            </div>

            <!-- Device Overview Stats -->
            <div class="grid-4" style="margin-bottom: 2rem;">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Total Devices</h3>
                        <span class="card-icon">üîå</span>
                    </div>
                    <div class="card-body">
                        <div style="font-size: 2.5rem; font-weight: 900; color: var(--cyan-glow);" id="totalDevices">12</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem;">Connected panels</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title text-success">Online</h3>
                        <span class="card-icon">‚úÖ</span>
                    </div>
                    <div class="card-body">
                        <div style="font-size: 2.5rem; font-weight: 900; color: var(--success);" id="onlineDevices">10</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem;">Active now</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title text-warning">Warning</h3>
                        <span class="card-icon">‚ö†Ô∏è</span>
                    </div>
                    <div class="card-body">
                        <div style="font-size: 2.5rem; font-weight: 900; color: var(--warning);" id="warningDevices">1</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem;">Needs attention</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title text-danger">Offline</h3>
                        <span class="card-icon">‚ùå</span>
                    </div>
                    <div class="card-body">
                        <div style="font-size: 2.5rem; font-weight: 900; color: var(--danger);" id="offlineDevices">1</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem;">Not responding</div>
                    </div>
                </div>
            </div>

            <!-- Device Grid -->
            <div class="grid-3" id="devicesGrid">
                <!-- Devices will be dynamically loaded here -->
            </div>
        </main>
    </div>

    <script src="../script.js"></script>
    <script src="../utils/useFetch.js"></script>
    <script>
        // Initialize devices page
        document.addEventListener('DOMContentLoaded', () => {
            loadDevices();
        });

        // Load devices from API or mock data
        function loadDevices() {
            // Mock device data - Replace with actual API call
            const devices = [
                { id: 'PV-001', name: 'Panel Array A1', status: 'online', efficiency: 94.5, uptime: '99.8%', power: 4.2, location: 'Roof Section 1' },
                { id: 'PV-002', name: 'Panel Array A2', status: 'online', efficiency: 92.8, uptime: '99.5%', power: 4.0, location: 'Roof Section 2' },
                { id: 'PV-003', name: 'Panel Array B1', status: 'online', efficiency: 95.2, uptime: '99.9%', power: 4.5, location: 'Roof Section 3' },
                { id: 'PV-004', name: 'Panel Array B2', status: 'warning', efficiency: 78.3, uptime: '97.2%', power: 3.1, location: 'Roof Section 4' },
                { id: 'PV-005', name: 'Panel Array C1', status: 'online', efficiency: 93.7, uptime: '99.7%', power: 4.3, location: 'Ground Mount 1' },
                { id: 'PV-006', name: 'Panel Array C2', status: 'online', efficiency: 91.5, uptime: '99.3%', power: 3.9, location: 'Ground Mount 2' },
                { id: 'PV-007', name: 'Panel Array D1', status: 'online', efficiency: 96.1, uptime: '99.9%', power: 4.7, location: 'Ground Mount 3' },
                { id: 'PV-008', name: 'Panel Array D2', status: 'offline', efficiency: 0, uptime: '0%', power: 0, location: 'Ground Mount 4' },
                { id: 'PV-009', name: 'Panel Array E1', status: 'online', efficiency: 94.0, uptime: '99.6%', power: 4.1, location: 'Carport Structure' },
                { id: 'PV-010', name: 'Panel Array E2', status: 'online', efficiency: 93.2, uptime: '99.4%', power: 4.0, location: 'Carport Structure' },
                { id: 'PV-011', name: 'Panel Array F1', status: 'online', efficiency: 95.8, uptime: '99.8%', power: 4.6, location: 'Storage Building' },
                { id: 'PV-012', name: 'Panel Array F2', status: 'online', efficiency: 92.5, uptime: '99.2%', power: 3.8, location: 'Storage Building' }
            ];

            const devicesGrid = document.getElementById('devicesGrid');
            devicesGrid.innerHTML = '';

            devices.forEach(device => {
                const deviceCard = createDeviceCard(device);
                devicesGrid.innerHTML += deviceCard;
            });
        }

        function createDeviceCard(device) {
            const statusColors = {
                online: 'var(--success)',
                warning: 'var(--warning)',
                offline: 'var(--danger)'
            };

            const statusIcons = {
                online: '‚úÖ',
                warning: '‚ö†Ô∏è',
                offline: '‚ùå'
            };

            return `
                <div class="card device-card" data-device-id="${device.id}">
                    <div class="card-header">
                        <div>
                            <h3 class="card-title">${device.name}</h3>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.3rem;">${device.id}</div>
                        </div>
                        <span style="font-size: 1.5rem;">${statusIcons[device.status]}</span>
                    </div>
                    <div class="card-body">
                        <div class="device-info">
                            <div class="info-row" style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                                <span style="color: var(--text-secondary);">Status:</span>
                                <span style="color: ${statusColors[device.status]}; font-weight: 700; text-transform: uppercase;">${device.status}</span>
                            </div>
                            <div class="info-row" style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                                <span style="color: var(--text-secondary);">Efficiency:</span>
                                <span style="color: var(--cyan-glow); font-weight: 700;">${device.efficiency}%</span>
                            </div>
                            <div class="info-row" style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                                <span style="color: var(--text-secondary);">Power Output:</span>
                                <span style="color: var(--solar-yellow); font-weight: 700;">${device.power} kW</span>
                            </div>
                            <div class="info-row" style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                                <span style="color: var(--text-secondary);">Uptime:</span>
                                <span style="color: var(--electric-blue); font-weight: 700;">${device.uptime}</span>
                            </div>
                            <div class="info-row" style="display: flex; justify-content: space-between; margin-bottom: 1.5rem;">
                                <span style="color: var(--text-secondary);">Location:</span>
                                <span style="color: var(--text-primary); font-weight: 600; font-size: 0.9rem;">${device.location}</span>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="device-btn" style="flex: 1; padding: 0.6rem; background: rgba(34, 211, 238, 0.1); border: 1px solid var(--cyan-glow); border-radius: 6px; color: var(--cyan-glow); cursor: pointer; font-weight: 600; transition: all 0.3s;" onclick="viewDeviceDetails('${device.id}')">
                                    View Details
                                </button>
                                <button class="device-btn" style="flex: 1; padding: 0.6rem; background: rgba(250, 204, 21, 0.1); border: 1px solid var(--solar-yellow); border-radius: 6px; color: var(--solar-yellow); cursor: pointer; font-weight: 600; transition: all 0.3s;" onclick="resetDevice('${device.id}')">
                                    Reset
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function viewDeviceDetails(deviceId) {
            alert(`Viewing details for device: ${deviceId}\n\nThis would open a detailed view with historical data, maintenance logs, and configuration options.`);
        }

        function resetDevice(deviceId) {
            if (confirm(`Are you sure you want to reset device ${deviceId}?`)) {
                alert(`Device ${deviceId} reset command sent successfully.`);
            }
        }
    </script>
</body>
</html>